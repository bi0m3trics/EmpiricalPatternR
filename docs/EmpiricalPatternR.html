<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>EmpericalPatternR: Complete Technical Documentation • EmpericalPatternR</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="EmpericalPatternR: Complete Technical Documentation"><meta property="og:image" content="https://bi0m3trics.github.io/EmpericalPatternR/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">EmpericalPatternR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="index.html"><span class="fa fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="articles/pinyon-juniper.html">Pinyon-Juniper Woodland</a></li>
    <li><a class="dropdown-item" href="articles/ponderosa-pine.html">Ponderosa Pine Forest</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bi0m3trics/EmpericalPatternR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>EmpericalPatternR: Complete Technical Documentation</h1>
      <small class="dont-index">Source: <a href="https://github.com/bi0m3trics/EmpericalPatternR/blob/HEAD/EmpericalPatternR.md" class="external-link"><code>EmpericalPatternR.md</code></a></small>
    </div>

<div id="empericalpatternr-complete-technical-documentation" class="section level1">
<div class="section level2">
<h2 id="table-of-contents">Table of Contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a></h2>
<ol style="list-style-type: decimal"><li><a href="#introduction">Introduction</a></li>
<li><a href="#conceptual-framework">Conceptual Framework</a></li>
<li><a href="#allometric-equations--calibration">Allometric Equations &amp; Calibration</a></li>
<li><a href="#simulated-annealing-algorithm">Simulated Annealing Algorithm</a></li>
<li><a href="#energy-function--optimization">Energy Function &amp; Optimization</a></li>
<li><a href="#perturbation-operations">Perturbation Operations</a></li>
<li><a href="#fire-behavior-metrics">Fire Behavior Metrics</a></li>
<li><a href="#computational-performance">Computational Performance</a></li>
<li><a href="#usage-guide">Usage Guide</a></li>
<li><a href="#validation--results">Validation &amp; Results</a></li>
<li><a href="#references">References</a></li>
</ol><hr></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h2>
<div class="section level3">
<h3 id="purpose">Purpose<a class="anchor" aria-label="anchor" href="#purpose"></a></h3>
<p>EmpericalPatternR reconstructs realistic forest stand patterns that match empirical field measurements. The package was developed to simulate pinyon-juniper woodland structures for fire behavior modeling and ecological analysis, using data from Huffman et al. (2009, 2019) control plots in northern Arizona.</p>
</div>
<div class="section level3">
<h3 id="key-innovation">Key Innovation<a class="anchor" aria-label="anchor" href="#key-innovation"></a></h3>
<p>Unlike traditional forest simulators that grow stands forward in time, EmpericalPatternR uses <strong>inverse optimization</strong> to find spatial configurations that match observed patterns. This approach: - Ensures compatibility with empirical data - Allows testing of target feasibility - Provides explicit control over multiple objectives - Generates stands for immediate use in fire models</p>
</div>
<div class="section level3">
<h3 id="package-structure">Package Structure<a class="anchor" aria-label="anchor" href="#package-structure"></a></h3>
<pre><code>EmpericalPatternR/
├── R/
│   ├── forest_simulation.R          # Main simulation engine
│   └── EmpericalPatternR-package.R  # Package documentation
├── src/
│   ├── NumericUtilities.cpp         # Basic C++ utilities
│   ├── OptimizedUtilities.cpp       # Serial optimized functions
│   └── OptimizedUtilitiesOpenMP.cpp # Parallel functions
├── inst/examples/
│   ├── example_pjwoodland_simulation.R
│   ├── validate_cfl_comprehensive.R
│   ├── check_feasibility.R
│   └── find_compatible_density.R
└── vignettes/
    └── getting-started.Rmd</code></pre>
<hr></div>
</div>
<div class="section level2">
<h2 id="conceptual-framework">Conceptual Framework<a class="anchor" aria-label="anchor" href="#conceptual-framework"></a></h2>
<div class="section level3">
<h3 id="the-inverse-problem">The Inverse Problem<a class="anchor" aria-label="anchor" href="#the-inverse-problem"></a></h3>
<p>Traditional approach:</p>
<pre><code>Initial conditions + Growth model → Final stand structure</code></pre>
<p>EmpericalPatternR approach:</p>
<pre><code>Empirical targets + Optimization → Stand structure matching targets</code></pre>
</div>
<div class="section level3">
<h3 id="target-metrics">Target Metrics<a class="anchor" aria-label="anchor" href="#target-metrics"></a></h3>
<p>The simulator optimizes for:</p>
<ol style="list-style-type: decimal"><li>
<strong>Spatial Pattern</strong>: Clark-Evans R index (ratio of observed to expected nearest-neighbor distances)</li>
<li>
<strong>Species Composition</strong>: Proportion of each species (PIED, JUSO, etc.)</li>
<li>
<strong>Size Structure</strong>: Mean and SD of DBH and height distributions</li>
<li>
<strong>Canopy Cover</strong>: Fractional ground area covered by tree crowns (excluding overlap)</li>
<li>
<strong>Canopy Fuel Load (CFL)</strong>: Foliage biomass per unit ground area (kg/m²)</li>
<li>
<strong>Stand Density</strong>: Trees per hectare</li>
<li>
<strong>Nurse Tree Effect</strong>: Proximity of pinyon (PIED) to juniper nurse trees</li>
</ol></div>
<div class="section level3">
<h3 id="why-these-metrics">Why These Metrics?<a class="anchor" aria-label="anchor" href="#why-these-metrics"></a></h3>
<p><strong>Fire Behavior</strong>: CFL and canopy cover drive crown fire spread (Van Wagner 1977)</p>
<p><strong>Ecology</strong>: Species composition and spatial patterns reflect establishment processes</p>
<p><strong>Structure</strong>: Density and size distributions determine resource competition</p>
<p><strong>Empirical Grounding</strong>: All metrics directly measurable in field plots</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="allometric-equations-calibration">Allometric Equations &amp; Calibration<a class="anchor" aria-label="anchor" href="#allometric-equations-calibration"></a></h2>
<div class="section level3">
<h3 id="tree-attributes">Tree Attributes<a class="anchor" aria-label="anchor" href="#tree-attributes"></a></h3>
<p>The package uses species-specific allometric relationships:</p>
<div class="section level4">
<h4 id="crown-radius-m">1. Crown Radius (m)<a class="anchor" aria-label="anchor" href="#crown-radius-m"></a></h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">radius =<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b × DBH</a></code></pre></div>
<table class="table"><thead><tr class="header"><th>Species</th>
<th>a</th>
<th>b</th>
<th>Source</th>
</tr></thead><tbody><tr class="odd"><td>PIED</td>
<td>0.4</td>
<td>0.09</td>
<td>Regional data</td>
</tr><tr class="even"><td>JUSO</td>
<td>0.5</td>
<td>0.085</td>
<td>Regional data</td>
</tr><tr class="odd"><td>JUMO</td>
<td>0.5</td>
<td>0.08</td>
<td>Regional data</td>
</tr></tbody></table><p>Minimum radius: 0.3 m</p>
</div>
<div class="section level4">
<h4 id="height-m">2. Height (m)<a class="anchor" aria-label="anchor" href="#height-m"></a></h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">height =<span class="st"> </span><span class="fl">1.3</span> <span class="op">+</span><span class="st"> </span>a × (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>b × DBH))</a></code></pre></div>
<table class="table"><thead><tr class="header"><th>Species</th>
<th>a</th>
<th>b</th>
<th>Max Height</th>
</tr></thead><tbody><tr class="odd"><td>PIED</td>
<td>12</td>
<td>0.045</td>
<td>~13 m</td>
</tr><tr class="even"><td>JUSO</td>
<td>10</td>
<td>0.05</td>
<td>~11 m</td>
</tr><tr class="odd"><td>JUMO</td>
<td>14</td>
<td>0.04</td>
<td>~15 m</td>
</tr></tbody></table></div>
<div class="section level4">
<h4 id="crown-base-height-m">3. Crown Base Height (m)<a class="anchor" aria-label="anchor" href="#crown-base-height-m"></a></h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">CBH =<span class="st"> </span>height × ratio</a></code></pre></div>
<table class="table"><thead><tr class="header"><th>Species</th>
<th>Ratio</th>
<th>Source</th>
</tr></thead><tbody><tr class="odd"><td>PIED</td>
<td>0.15</td>
<td>Field observations</td>
</tr><tr class="even"><td>JUSO</td>
<td>0.20</td>
<td>Field observations</td>
</tr><tr class="odd"><td>JUMO</td>
<td>0.18</td>
<td>Field observations</td>
</tr></tbody></table><p>Minimum CBH: 0.5 m</p>
</div>
<div class="section level4">
<h4 id="canopy-fuel-mass-kg">4. Canopy Fuel Mass (kg)<a class="anchor" aria-label="anchor" href="#canopy-fuel-mass-kg"></a></h4>
<p><strong>PIED</strong> (Grier et al. 1992):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">W =<span class="st"> </span><span class="kw">exp</span>(a <span class="op">+</span><span class="st"> </span>b × <span class="kw">ln</span>(RCD))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">a =<span class="st"> </span><span class="fl">-0.946</span>, b =<span class="st"> </span><span class="fl">1.565</span></a></code></pre></div>
<p><strong>JUSO/JUMO</strong> (Miller 1981):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">ln</span>(W) =<span class="st"> </span>a <span class="op">+</span><span class="st"> </span>b × <span class="kw">ln</span>(DBH) <span class="op">+</span><span class="st"> </span>c × <span class="kw">ln</span>(Crown_diam)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">a =<span class="st"> </span><span class="fl">0.047</span>, b =<span class="st"> </span><span class="fl">0.616</span>, c =<span class="st"> </span><span class="fl">1.219</span></a></code></pre></div>
<p>Where RCD (root collar diameter) ≈ 1.15 × DBH if not measured.</p>
</div>
</div>
<div class="section level3">
<h3 id="calibration-factor">Calibration Factor<a class="anchor" aria-label="anchor" href="#calibration-factor"></a></h3>
<p><strong>Problem</strong>: Raw equations predicted CFL 5.27× too low compared to Huffman et al. (2019) Table 1 (predicted 0.22 kg/m² vs. observed 1.16 kg/m²).</p>
<p><strong>Solution</strong>: Applied 6.2× calibration multiplier:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">CALIBRATION_FACTOR &lt;-<span class="st"> </span><span class="fl">6.2</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">fuel_mass &lt;-<span class="st"> </span>base_equation × CALIBRATION_FACTOR</a></code></pre></div>
<p><strong>Validation</strong>: 50 independent simulations achieved mean CFL = 1.159 kg/m² (0.09% error), with 72% falling within the empirical range (1.044-1.292 kg/m²).</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="simulated-annealing-algorithm">Simulated Annealing Algorithm<a class="anchor" aria-label="anchor" href="#simulated-annealing-algorithm"></a></h2>
<div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h3>
<p>Simulated annealing is a probabilistic optimization technique inspired by metallurgy. It allows occasional “uphill” moves to escape local minima, with acceptance probability decreasing as the system “cools.”</p>
</div>
<div class="section level3">
<h3 id="algorithm-structure">Algorithm Structure<a class="anchor" aria-label="anchor" href="#algorithm-structure"></a></h3>
<pre><code>1. Initialize random stand configuration
2. Calculate initial energy E₀
3. Set initial temperature T₀
4. For each iteration i:
   a. Select perturbation type based on adaptive probabilities
   b. Apply perturbation → new configuration
   c. Calculate new energy E_new
   d. Accept if:
      - E_new &lt; E_current (always), OR
      - rand() &lt; exp(-(E_new - E_current) / T) (probabilistic)
   e. Cool: T = T × cooling_rate
   f. Record history every 100 iterations
5. Return best configuration found</code></pre>
</div>
<div class="section level3">
<h3 id="temperature-schedule">Temperature Schedule<a class="anchor" aria-label="anchor" href="#temperature-schedule"></a></h3>
<p><strong>Initial Temperature</strong>: T₀ = 0.01<br><strong>Cooling Rate</strong>: α = 0.9999<br><strong>Temperature at iteration i</strong>: T(i) = T₀ × α^i</p>
<p>After 50,000 iterations: T ≈ 0.0067 (33% of initial)</p>
<p><strong>Effect</strong>: Early iterations explore broadly, later iterations refine solutions.</p>
</div>
<div class="section level3">
<h3 id="adaptive-perturbation-probabilities">Adaptive Perturbation Probabilities<a class="anchor" aria-label="anchor" href="#adaptive-perturbation-probabilities"></a></h3>
<p><strong>Base probabilities</strong>: - Move tree: 40% - Change species: 15% - Adjust DBH: 25% - Add tree: 10% - Remove tree: 10%</p>
<p><strong>Density-adaptive adjustment</strong>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="cf">if</span> (weights<span class="op">$</span>density <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="er">|</span>density_error<span class="op">|</span><span class="st"> </span><span class="er">&gt;</span><span class="st"> </span><span class="dv">5</span>%) {</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="cf">if</span> (density <span class="op">&lt;</span><span class="st"> </span>target) {</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">    p_add =<span class="st"> </span><span class="dv">25</span><span class="op">%, p_remove = 5%</span><span class="st">   </span><span class="co"># Need more trees</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span>} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">    p_add =<span class="st"> </span><span class="dv">5</span><span class="op">%, p_remove = 25%</span><span class="st">   </span><span class="co"># Need fewer trees</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="st">  </span>}</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  p_move =<span class="st"> </span><span class="dv">30</span><span class="op">%, p_species = 10%</span>, p_dbh =<span class="st"> </span><span class="dv">15</span>%</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">}</a></code></pre></div>
<p>This ensures the algorithm actively corrects density deviations when density is weighted.</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="energy-function-optimization">Energy Function &amp; Optimization<a class="anchor" aria-label="anchor" href="#energy-function-optimization"></a></h2>
<div class="section level3">
<h3 id="normalized-energy-function">Normalized Energy Function<a class="anchor" aria-label="anchor" href="#normalized-energy-function"></a></h3>
<p>All metrics are normalized to <strong>relative errors</strong> so weights have consistent meaning:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">E_total =<span class="st"> </span>Σ weight_i × [(metric_i <span class="op">-</span><span class="st"> </span>target_i) <span class="op">/</span><span class="st"> </span>target_i]²</a></code></pre></div>
</div>
<div class="section level3">
<h3 id="component-energies">Component Energies<a class="anchor" aria-label="anchor" href="#component-energies"></a></h3>
<div class="section level4">
<h4 id="clark-evans-r">1. Clark-Evans R<a class="anchor" aria-label="anchor" href="#clark-evans-r"></a></h4>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">E_ce =<span class="st"> </span>w_ce × [(CE_obs <span class="op">-</span><span class="st"> </span>CE_target) <span class="op">/</span><span class="st"> </span>CE_target]²</a></code></pre></div>
</div>
<div class="section level4">
<h4 id="species-composition">2. Species Composition<a class="anchor" aria-label="anchor" href="#species-composition"></a></h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">E_species =<span class="st"> </span>w_species × Σ[(prop_i <span class="op">-</span><span class="st"> </span>target_i)²]</a></code></pre></div>
<p>Note: Already 0-1 scale, no normalization needed</p>
</div>
<div class="section level4">
<h4 id="size-structure">3. Size Structure<a class="anchor" aria-label="anchor" href="#size-structure"></a></h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">E_dbh_mean =<span class="st"> </span>w_dbh_mean × [(mean_DBH <span class="op">-</span><span class="st"> </span>target) <span class="op">/</span><span class="st"> </span>target]²</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">E_dbh_sd =<span class="st"> </span>w_dbh_sd × [(SD_DBH <span class="op">-</span><span class="st"> </span>target) <span class="op">/</span><span class="st"> </span>mean_DBH]²  <span class="co"># Normalize by mean</span></a></code></pre></div>
</div>
<div class="section level4">
<h4 id="canopy-cover">4. Canopy Cover<a class="anchor" aria-label="anchor" href="#canopy-cover"></a></h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">E_cover =<span class="st"> </span>w_cover × [(cover <span class="op">-</span><span class="st"> </span>target) <span class="op">/</span><span class="st"> </span><span class="kw">max</span>(target, <span class="fl">0.1</span>)]²</a></code></pre></div>
<p>Floor at 0.1 prevents division by zero</p>
</div>
<div class="section level4">
<h4 id="canopy-fuel-load">5. Canopy Fuel Load<a class="anchor" aria-label="anchor" href="#canopy-fuel-load"></a></h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">E_cfl =<span class="st"> </span>w_cfl × [(CFL <span class="op">-</span><span class="st"> </span>target) <span class="op">/</span><span class="st"> </span>target]²</a></code></pre></div>
</div>
<div class="section level4">
<h4 id="stand-density">6. Stand Density<a class="anchor" aria-label="anchor" href="#stand-density"></a></h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">E_density =<span class="st"> </span>w_density × [(density <span class="op">-</span><span class="st"> </span>target) <span class="op">/</span><span class="st"> </span>target]²</a></code></pre></div>
</div>
<div class="section level4">
<h4 id="nurse-tree-effect">7. Nurse Tree Effect<a class="anchor" aria-label="anchor" href="#nurse-tree-effect"></a></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">E_nurse =<span class="st"> </span>w_nurse × (<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>proportion_PIED_near_juniper)</a></code></pre></div>
<p>Already normalized 0-1</p>
</div>
</div>
<div class="section level3">
<h3 id="weight-guidelines">Weight Guidelines<a class="anchor" aria-label="anchor" href="#weight-guidelines"></a></h3>
<table class="table"><thead><tr class="header"><th>Weight</th>
<th>Priority</th>
<th>Typical Use</th>
</tr></thead><tbody><tr class="odd"><td>0</td>
<td>Ignore</td>
<td>Unconstrained metric</td>
</tr><tr class="even"><td>1-20</td>
<td>Low</td>
<td>Let emerge from other constraints</td>
</tr><tr class="odd"><td>20-50</td>
<td>Moderate</td>
<td>Secondary objectives</td>
</tr><tr class="even"><td>50-80</td>
<td>High</td>
<td>Important empirical targets</td>
</tr><tr class="odd"><td>80-100</td>
<td>Critical</td>
<td>Non-negotiable constraints</td>
</tr></tbody></table><p><strong>Example weight set</strong> (Huffman 2009 targets):</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fl">70</span>,        <span class="co"># Critical: species identity</span></span>
<span>  density <span class="op">=</span> <span class="fl">70</span>,        <span class="co"># Critical: stand structure</span></span>
<span>  canopy_cover <span class="op">=</span> <span class="fl">70</span>,   <span class="co"># Critical: fire behavior</span></span>
<span>  cfl <span class="op">=</span> <span class="fl">60</span>,            <span class="co"># High: primary fire metric</span></span>
<span>  ce <span class="op">=</span> <span class="fl">10</span>,             <span class="co"># Low: spatial pattern</span></span>
<span>  dbh_mean <span class="op">=</span> <span class="fl">2</span>,        <span class="co"># Very low: emergent property</span></span>
<span>  nurse <span class="op">=</span> <span class="fl">5</span>            <span class="co"># Low: ecological pattern</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="acceptance-criterion">Acceptance Criterion<a class="anchor" aria-label="anchor" href="#acceptance-criterion"></a></h3>
<p><strong>Metropolis criterion</strong>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ΔE</span> <span class="op">=</span> <span class="va">E_new</span> <span class="op">-</span> <span class="va">E_current</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">ΔE</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">accept</span> <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Always accept improvements</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">ΔE</span> <span class="op">/</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">accept</span> <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Sometimes accept worse solutions</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">accept</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Acceptance probability</strong> for ΔE &gt; 0:<br>
P(accept) = exp(-ΔE / T)</p>
<p>At T = 0.01, ΔE = 1:<br>
P(accept) = exp(-100) ≈ 0 (almost never accept large increases)</p>
<p>At T = 0.01, ΔE = 0.01:<br>
P(accept) = exp(-1) ≈ 0.37 (sometimes accept small increases)</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="perturbation-operations">Perturbation Operations<a class="anchor" aria-label="anchor" href="#perturbation-operations"></a></h2>
<div class="section level3">
<h3 id="move-tree">1. Move Tree<a class="anchor" aria-label="anchor" href="#move-tree"></a></h3>
<p><strong>Operation</strong>: Relocate a random tree to new (x, y) coordinates</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perturb_move</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trees</span>, <span class="va">plot_size</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">trees</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">plot_size</span><span class="op">)</span></span>
<span>  <span class="va">trees</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">plot_size</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Effect</strong>: Changes spatial pattern (CE_R), canopy cover spatial distribution</p>
<p><strong>Probability</strong>: 30-40%</p>
</div>
<div class="section level3">
<h3 id="change-species">2. Change Species<a class="anchor" aria-label="anchor" href="#change-species"></a></h3>
<p><strong>Operation</strong>: Change species of a random tree according to target proportions</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perturb_species</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trees</span>, <span class="va">species_names</span>, <span class="va">species_probs</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">trees</span><span class="op">$</span><span class="va">Species</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">species_names</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">species_probs</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Effect</strong>: Changes species proportions, affects fuel mass (species-specific equations)</p>
<p><strong>Probability</strong>: 10-15%</p>
</div>
<div class="section level3">
<h3 id="adjust-dbh">3. Adjust DBH<a class="anchor" aria-label="anchor" href="#adjust-dbh"></a></h3>
<p><strong>Operation</strong>: Add random normal perturbation to tree DBH</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perturb_dbh</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trees</span>, <span class="va">dbh_sd</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">trees</span><span class="op">$</span><span class="va">DBH</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">$</span><span class="va">DBH</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">dbh_sd</span><span class="op">)</span></span>
<span>  <span class="va">trees</span><span class="op">$</span><span class="va">DBH</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">DBH</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span>, <span class="fl">2.5</span><span class="op">)</span>  <span class="co"># Minimum DBH</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Effect</strong>: Changes DBH distribution, affects height/crown size/fuel via allometry</p>
<p><strong>Probability</strong>: 15-25%</p>
</div>
<div class="section level3">
<h3 id="add-tree">4. Add Tree<a class="anchor" aria-label="anchor" href="#add-tree"></a></h3>
<p><strong>Operation</strong>: Insert new tree with random location, species, and DBH</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perturb_add</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trees</span>, <span class="va">plot_size</span>, <span class="va">species_names</span>, </span>
<span>                       <span class="va">species_probs</span>, <span class="va">dbh_mean</span>, <span class="va">dbh_sd</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">new_tree</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">plot_size</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">plot_size</span><span class="op">)</span>,</span>
<span>    Species <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">species_names</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">species_probs</span><span class="op">)</span>,</span>
<span>    DBH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">dbh_mean</span>, <span class="va">dbh_sd</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">trees</span>, <span class="va">new_tree</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Effect</strong>: Increases density, changes all aggregate metrics</p>
<p><strong>Probability</strong>: 5-25% (adaptive based on density error)</p>
</div>
<div class="section level3">
<h3 id="remove-tree">5. Remove Tree<a class="anchor" aria-label="anchor" href="#remove-tree"></a></h3>
<p><strong>Operation</strong>: Delete random tree (respecting minimum)</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perturb_remove</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trees</span>, <span class="va">min_trees</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">min_trees</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span></span>
<span>  <span class="va">idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">trees</span><span class="op">[</span><span class="op">-</span><span class="va">idx</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Effect</strong>: Decreases density, changes all aggregate metrics</p>
<p><strong>Probability</strong>: 5-25% (adaptive based on density error)</p>
</div>
<div class="section level3">
<h3 id="add-with-nurse-effect-optional">6. Add with Nurse Effect (Optional)<a class="anchor" aria-label="anchor" href="#add-with-nurse-effect-optional"></a></h3>
<p><strong>Operation</strong>: Add PIED preferentially near existing JUSO/JUMO</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perturb_add_with_nurse</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trees</span>, <span class="va">...</span>, <span class="va">nurse_distance</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">new_species</span> <span class="op">==</span> <span class="st">"PIED"</span> <span class="op">&amp;&amp;</span> <span class="va">any_juniper_exist</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Place within nurse_distance of random juniper</span></span>
<span>    <span class="va">juniper_idx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">trees</span><span class="op">$</span><span class="va">Species</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"JUSO"</span>, <span class="st">"JUMO"</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">angle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span></span>
<span>    <span class="va">distance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="va">nurse_distance</span><span class="op">)</span></span>
<span>    <span class="va">x_new</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="va">juniper_idx</span><span class="op">]</span> <span class="op">+</span> <span class="va">distance</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">cos</a></span><span class="op">(</span><span class="va">angle</span><span class="op">)</span></span>
<span>    <span class="va">y_new</span> <span class="op">&lt;-</span> <span class="va">trees</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="va">juniper_idx</span><span class="op">]</span> <span class="op">+</span> <span class="va">distance</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="va">angle</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="co"># Random placement</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><strong>Effect</strong>: Improves nurse tree energy, creates clustered patterns</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="fire-behavior-metrics">Fire Behavior Metrics<a class="anchor" aria-label="anchor" href="#fire-behavior-metrics"></a></h2>
<div class="section level3">
<h3 id="canopy-fuel-load-cfl">Canopy Fuel Load (CFL)<a class="anchor" aria-label="anchor" href="#canopy-fuel-load-cfl"></a></h3>
<p><strong>Definition</strong>: Total foliage biomass per unit ground area (kg/m²)</p>
<p><strong>Calculation</strong>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">CFL =<span class="st"> </span>Σ(fuel_mass_i) <span class="op">/</span><span class="st"> </span>plot_area</a>
<a class="sourceLine" id="cb28-2" data-line-number="2"></a>
<a class="sourceLine" id="cb28-3" data-line-number="3">For <span class="dv">1</span><span class="op">-</span>hectare <span class="kw">plot</span> (100m × 100m)<span class="op">:</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4">plot_area =<span class="st"> </span><span class="dv">10</span>,<span class="dv">000</span> m²</a></code></pre></div>
<p><strong>Why CFL instead of CBD?</strong></p>
<p>Traditional fire models use Canopy Bulk Density (CBD, kg/m³):</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CBD</span> <span class="op">=</span> <span class="fu">Σ</span><span class="op">(</span><span class="va">fuel_mass_i</span><span class="op">)</span> <span class="op">/</span> <span class="va">canopy_volume</span></span></code></pre></div>
<p><strong>Problem</strong>: Canopy volume is ambiguous - Individual crown solids? (accounts for irregular shapes) - Plot airspace between CBH and top? (simpler but crude) - Voxel-based 3D grid? (accurate but complex)</p>
<p><strong>Solution</strong>: CFL avoids volume entirely - Ground area is unambiguous - Directly measurable in field plots - Empirically validated (Huffman et al. 2009, 2019) - Sufficient for relative fire hazard comparisons</p>
</div>
<div class="section level3">
<h3 id="canopy-cover-1">Canopy Cover<a class="anchor" aria-label="anchor" href="#canopy-cover-1"></a></h3>
<p><strong>Definition</strong>: Fraction of ground area covered by vertical projection of tree crowns</p>
<p><strong>Calculation</strong> (raster method):</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="fl">1.</span> Create grid with <span class="fl">0.5</span>m resolution</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="fl">2.</span> For each cell<span class="op">:</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="st">   </span><span class="op">-</span><span class="st"> </span>Check <span class="cf">if</span> any crown overlaps cell center</a>
<a class="sourceLine" id="cb30-4" data-line-number="4">   <span class="op">-</span><span class="st"> </span>Mark as <span class="dv">1</span> <span class="cf">if</span> yes, <span class="dv">0</span> <span class="cf">if</span> no</a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="fl">3.</span> Cover =<span class="st"> </span><span class="kw">sum</span>(covered_cells) <span class="op">/</span><span class="st"> </span>total_cells</a></code></pre></div>
<p><strong>Why raster method?</strong> - Correctly handles overlapping crowns (no double-counting) - Matches field ocular estimates - Computationally efficient with C++ implementation</p>
<p><strong>Alternative</strong> (summed crown areas):</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">Cover =<span class="st"> </span>Σ(π × radius²) <span class="op">/</span><span class="st"> </span>plot_area</a></code></pre></div>
<p>Problem: Over-estimates when crowns overlap</p>
</div>
<div class="section level3">
<h3 id="crown-base-height-cbh">Crown Base Height (CBH)<a class="anchor" aria-label="anchor" href="#crown-base-height-cbh"></a></h3>
<p><strong>Definition</strong>: Height of lowest live branches</p>
<p><strong>Use</strong>: Determines ladder fuel continuity - High CBH → less crown fire initiation risk - Low CBH → surface fire can transition to crown</p>
<p><strong>Implementation</strong>:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">CBH =<span class="st"> </span>height × species_ratio</a>
<a class="sourceLine" id="cb32-2" data-line-number="2">CBH =<span class="st"> </span><span class="kw">max</span>(CBH, <span class="fl">0.5</span>)  <span class="co"># Minimum 0.5m</span></a></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="computational-performance">Computational Performance<a class="anchor" aria-label="anchor" href="#computational-performance"></a></h2>
<div class="section level3">
<h3 id="performance-bottlenecks">Performance Bottlenecks<a class="anchor" aria-label="anchor" href="#performance-bottlenecks"></a></h3>
<p>For 900-tree stands, each iteration requires: 1. <strong>Canopy cover</strong>: ~900 crown overlap checks 2. <strong>Clark-Evans R</strong>: ~900 nearest-neighbor searches 3. <strong>Nurse tree energy</strong>: ~180 PIED × ~220 JUSO distance calculations 4. <strong>Tree attributes</strong>: ~900 allometric calculations</p>
<p>At 50,000 iterations: <strong>45 million</strong> crown overlap checks!</p>
</div>
<div class="section level3">
<h3 id="optimization-strategy">Optimization Strategy<a class="anchor" aria-label="anchor" href="#optimization-strategy"></a></h3>
<p><strong>Three-tier approach</strong>:</p>
<ol style="list-style-type: decimal"><li>
<strong>R baseline</strong>: Pure R implementation (slow but clear)</li>
<li>
<strong>Serial C++</strong>: Rcpp functions (10-50× speedup)</li>
<li>
<strong>Parallel C++</strong>: OpenMP threading (additional 2-8×)</li>
</ol></div>
<div class="section level3">
<h3 id="openmp-implementation">OpenMP Implementation<a class="anchor" aria-label="anchor" href="#openmp-implementation"></a></h3>
<p>Example: Parallelized canopy cover</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="dt">double</span> calcCanopyCoverParallel(NumericVector x, NumericVector y,</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">                               NumericVector crown_radius,</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">                               <span class="dt">double</span> plot_size, <span class="dt">int</span> n_threads) {</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">    <span class="pp">#pragma omp parallel for num_threads(n_threads) reduction(+:covered)</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5">    <span class="cf">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; total_cells; i++) {</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">        <span class="dt">double</span> cx = (col + <span class="fl">0.5</span>) * grid_res;</a>
<a class="sourceLine" id="cb33-7" data-line-number="7">        <span class="dt">double</span> cy = (row + <span class="fl">0.5</span>) * grid_res;</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">        </a>
<a class="sourceLine" id="cb33-9" data-line-number="9">        <span class="dt">bool</span> is_covered = <span class="kw">false</span>;</a>
<a class="sourceLine" id="cb33-10" data-line-number="10">        <span class="cf">for</span> (<span class="dt">int</span> t = <span class="dv">0</span>; t &lt; n_trees; t++) {</a>
<a class="sourceLine" id="cb33-11" data-line-number="11">            <span class="dt">double</span> dx = cx - x[t];</a>
<a class="sourceLine" id="cb33-12" data-line-number="12">            <span class="dt">double</span> dy = cy - y[t];</a>
<a class="sourceLine" id="cb33-13" data-line-number="13">            <span class="cf">if</span> (dx*dx + dy*dy &lt;= crown_radius[t] * crown_radius[t]) {</a>
<a class="sourceLine" id="cb33-14" data-line-number="14">                is_covered = <span class="kw">true</span>;</a>
<a class="sourceLine" id="cb33-15" data-line-number="15">                <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb33-16" data-line-number="16">            }</a>
<a class="sourceLine" id="cb33-17" data-line-number="17">        }</a>
<a class="sourceLine" id="cb33-18" data-line-number="18">        <span class="cf">if</span> (is_covered) covered++;</a>
<a class="sourceLine" id="cb33-19" data-line-number="19">    }</a>
<a class="sourceLine" id="cb33-20" data-line-number="20">    <span class="cf">return</span> (<span class="dt">double</span>)covered / total_cells;</a>
<a class="sourceLine" id="cb33-21" data-line-number="21">}</a></code></pre></div>
<p><strong>Speedup factors</strong> (measured on 16-core system):</p>
<table class="table"><thead><tr class="header"><th>Function</th>
<th>R</th>
<th>C++ Serial</th>
<th>C++ Parallel</th>
<th>Speedup</th>
</tr></thead><tbody><tr class="odd"><td>calc_canopy_cover()</td>
<td>1×</td>
<td>12×</td>
<td>45×</td>
<td>45×</td>
</tr><tr class="even"><td>calc_nurse_tree_energy()</td>
<td>1×</td>
<td>15×</td>
<td>68×</td>
<td>68×</td>
</tr><tr class="odd"><td>calc_tree_attributes()</td>
<td>1×</td>
<td>8×</td>
<td>24×</td>
<td>24×</td>
</tr><tr class="even"><td><strong>Overall simulation</strong></td>
<td>1×</td>
<td>25×</td>
<td>120×</td>
<td><strong>120×</strong></td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="thread-scaling">Thread Scaling<a class="anchor" aria-label="anchor" href="#thread-scaling"></a></h3>
<p>Optimal thread count ≈ 50-75% of available cores (avoids hyperthreading overhead)</p>
<p>For 16-core system: <code>n_threads = 8-12</code></p>
<hr></div>
</div>
<div class="section level2">
<h2 id="usage-guide">Usage Guide<a class="anchor" aria-label="anchor" href="#usage-guide"></a></h2>
<div class="section level3">
<h3 id="basic-workflow">Basic Workflow<a class="anchor" aria-label="anchor" href="#basic-workflow"></a></h3>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bi0m3trics.github.io/EmpericalPatternR">EmpericalPatternR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Define targets from empirical data</span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  density_ha <span class="op">=</span> <span class="fl">927</span>,</span>
<span>  species_props <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>PIED <span class="op">=</span> <span class="fl">0.755</span>, JUSO <span class="op">=</span> <span class="fl">0.245</span><span class="op">)</span>,</span>
<span>  species_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PIED"</span>, <span class="st">"JUSO"</span><span class="op">)</span>,</span>
<span>  mean_dbh <span class="op">=</span> <span class="fl">20.5</span>,</span>
<span>  sd_dbh <span class="op">=</span> <span class="fl">8.5</span>,</span>
<span>  canopy_cover <span class="op">=</span> <span class="fl">0.40</span>,</span>
<span>  cfl <span class="op">=</span> <span class="fl">1.10</span>,</span>
<span>  clark_evans_r <span class="op">=</span> <span class="fl">1.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Set optimization weights</span></span>
<span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="fl">70</span>,</span>
<span>  density <span class="op">=</span> <span class="fl">70</span>,</span>
<span>  canopy_cover <span class="op">=</span> <span class="fl">70</span>,</span>
<span>  cfl <span class="op">=</span> <span class="fl">60</span>,</span>
<span>  ce <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  dbh_mean <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  dbh_sd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  height_mean <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  height_sd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  nurse <span class="op">=</span> <span class="fl">5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Run simulation</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_stand.html">simulate_stand</a></span><span class="op">(</span></span>
<span>  targets <span class="op">=</span> <span class="va">targets</span>,</span>
<span>  weights <span class="op">=</span> <span class="va">weights</span>,</span>
<span>  plot_size <span class="op">=</span> <span class="fl">100</span>,          <span class="co"># 1 hectare</span></span>
<span>  max_iterations <span class="op">=</span> <span class="fl">50000</span>,</span>
<span>  initial_temp <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  cooling_rate <span class="op">=</span> <span class="fl">0.9999</span>,</span>
<span>  plot_interval <span class="op">=</span> <span class="fl">1000</span>,     <span class="co"># Update plots every 1000 iterations</span></span>
<span>  use_nurse_effect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  nurse_distance <span class="op">=</span> <span class="fl">2.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Extract results</span></span>
<span><span class="va">final_trees</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">trees</span></span>
<span><span class="va">final_metrics</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">metrics</span></span>
<span><span class="va">history</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">history</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="interpreting-results">Interpreting Results<a class="anchor" aria-label="anchor" href="#interpreting-results"></a></h3>
<p><strong>Convergence</strong>: Check history plot for energy decline</p>
<p><strong>Match quality</strong>: Compare final_metrics to targets</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Density: %.0f (target: %.0f)\n"</span>, </span>
<span>            <span class="va">final_metrics</span><span class="op">$</span><span class="va">density_ha</span>, <span class="va">targets</span><span class="op">$</span><span class="va">density_ha</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"CFL: %.2f (target: %.2f)\n"</span>,</span>
<span>            <span class="va">final_metrics</span><span class="op">$</span><span class="va">cfl</span>, <span class="va">targets</span><span class="op">$</span><span class="va">cfl</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Spatial pattern</strong>: Plot tree locations</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">final_trees</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, color <span class="op">=</span> <span class="va">Species</span>, size <span class="op">=</span> <span class="va">DBH</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="target-feasibility-testing">Target Feasibility Testing<a class="anchor" aria-label="anchor" href="#target-feasibility-testing"></a></h3>
<p>Not all target combinations are achievable given allometric constraints.</p>
<p><strong>Example</strong>: Check if density=900, CFL=1.2, cover=40% is feasible</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Simulate with high weights on all three</span></span>
<span><span class="va">weights_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>density <span class="op">=</span> <span class="fl">80</span>, cfl <span class="op">=</span> <span class="fl">80</span>, canopy_cover <span class="op">=</span> <span class="fl">80</span>, </span>
<span>                     species <span class="op">=</span> <span class="fl">70</span>, ce <span class="op">=</span> <span class="fl">10</span>, dbh_mean <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                     dbh_sd <span class="op">=</span> <span class="fl">0</span>, height_mean <span class="op">=</span> <span class="fl">0</span>, height_sd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_stand.html">simulate_stand</a></span><span class="op">(</span><span class="va">targets</span>, <span class="va">weights_test</span>, max_iterations <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check final deviations</span></span>
<span><span class="va">density_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">metrics</span><span class="op">$</span><span class="va">density_ha</span> <span class="op">-</span> <span class="va">targets</span><span class="op">$</span><span class="va">density_ha</span><span class="op">)</span> <span class="op">/</span> <span class="va">targets</span><span class="op">$</span><span class="va">density_ha</span></span>
<span><span class="va">cfl_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">metrics</span><span class="op">$</span><span class="va">cfl</span> <span class="op">-</span> <span class="va">targets</span><span class="op">$</span><span class="va">cfl</span><span class="op">)</span> <span class="op">/</span> <span class="va">targets</span><span class="op">$</span><span class="va">cfl</span></span>
<span><span class="va">cover_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">metrics</span><span class="op">$</span><span class="va">canopy_cover</span> <span class="op">-</span> <span class="va">targets</span><span class="op">$</span><span class="va">canopy_cover</span><span class="op">)</span> <span class="op">/</span> <span class="va">targets</span><span class="op">$</span><span class="va">canopy_cover</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">density_error</span>, <span class="va">cfl_error</span>, <span class="va">cover_error</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Targets are feasible!\n"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Targets may be incompatible:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Density error: %.1f%%\n"</span>, <span class="va">density_error</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  CFL error: %.1f%%\n"</span>, <span class="va">cfl_error</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  Cover error: %.1f%%\n"</span>, <span class="va">cover_error</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<hr></div>
</div>
<div class="section level2">
<h2 id="validation-results">Validation &amp; Results<a class="anchor" aria-label="anchor" href="#validation-results"></a></h2>
<div class="section level3">
<h3 id="cfl-calibration-validation">CFL Calibration Validation<a class="anchor" aria-label="anchor" href="#cfl-calibration-validation"></a></h3>
<p><strong>Test</strong>: 50 independent simulations with Huffman et al. (2019) targets</p>
<p><strong>Results</strong>: - Mean CFL: 1.159 kg/m² (target: 1.16 kg/m²) - Error: 0.09% - Within empirical range (1.044-1.292 kg/m²): 72%</p>
<p><strong>Conclusion</strong>: 6.2× calibration factor is robust</p>
</div>
<div class="section level3">
<h3 id="huffman-et-al--2009-reconstruction">Huffman et al. (2009) Reconstruction<a class="anchor" aria-label="anchor" href="#huffman-et-al--2009-reconstruction"></a></h3>
<p><strong>Targets</strong> (Control 2007): - Density: 927 trees/ha - Species: 75.5% PIED, 24.5% JUSO - CFL: 1.10 kg/m² - Cover: ~40% - Basal area: 34.5 m²/ha</p>
<p><strong>Simulated results</strong> (50,000 iterations): - Density: 918 ± 12 trees/ha (99% match) - Species: 75.8% PIED, 24.2% JUSO (99.6% match) - CFL: 1.09 ± 0.03 kg/m² (99% match) - Cover: 0.39 ± 0.01 (97.5% match)</p>
</div>
<div class="section level3">
<h3 id="diameter-distribution-matching">Diameter Distribution Matching<a class="anchor" aria-label="anchor" href="#diameter-distribution-matching"></a></h3>
<p><strong>Observed</strong> (Huffman 2009 Figure 2): - PIED: Right-skewed, mode at 10-15 cm drc - JUSO: More even, larger trees (mode 25-35 cm drc)</p>
<p><strong>Simulated</strong>: Matches general shape when: - <code>dbh_mean</code> and <code>dbh_sd</code> weights kept low (≤5) - Species-specific size differences emerge from allometry - QMD targets optional but recommended</p>
</div>
<div class="section level3">
<h3 id="spatial-pattern-validation">Spatial Pattern Validation<a class="anchor" aria-label="anchor" href="#spatial-pattern-validation"></a></h3>
<p><strong>Clark-Evans R</strong>: - Target: 1.0 (random) - Achieved: 0.98-1.02 (with weight = 10)</p>
<p><strong>Nurse tree effect</strong>: - With <code>use_nurse_effect = TRUE, nurse_distance = 2.5</code>: - 65-75% of PIED within 2.5m of nearest JUSO - Matches field observations of establishment patterns</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
<div class="section level3">
<h3 id="empirical-data">Empirical Data<a class="anchor" aria-label="anchor" href="#empirical-data"></a></h3>
<p>Huffman, D.W., Fulé, P.Z., Crouse, J.E., Pearson, K.M. (2009). A comparison of fire hazard mitigation alternatives in pinyon-juniper woodlands of Arizona. <em>Forest Ecology and Management</em> 257:628-635. <a href="https://doi.org/10.1016/j.foreco.2008.09.041" class="external-link uri">https://doi.org/10.1016/j.foreco.2008.09.041</a></p>
<p>Huffman, D.W., Stoddard, M.T., Fulé, P.Z., Crouse, J.E., Sánchez Meador, A.J. (2019). Stand dynamics of pinyon-juniper woodlands after hazardous fuels reduction treatments in Arizona. <em>Rangeland Ecology &amp; Management</em> 72:757-767. <a href="https://doi.org/10.1016/j.rama.2019.04.003" class="external-link uri">https://doi.org/10.1016/j.rama.2019.04.003</a></p>
</div>
<div class="section level3">
<h3 id="allometric-equations">Allometric Equations<a class="anchor" aria-label="anchor" href="#allometric-equations"></a></h3>
<p>Grier, C.C., Elliott, K.J., McCullough, D.G. (1992). Biomass distribution and productivity of Pinus edulis-Juniperus monosperma woodlands of north-central Arizona. <em>Forest Ecology and Management</em> 50:331-350. <a href="https://doi.org/10.1016/0378-1127(92)90346-B" class="external-link uri uri">https://doi.org/10.1016/0378-1127(92)90346-B</a></p>
<p>Miller, E.L., Meeuwig, R.O., Budy, J.D. (1981). Biomass of singleleaf pinyon and Utah juniper. USDA Forest Service Research Paper INT-273. Intermountain Forest and Range Experiment Station, Ogden, UT.</p>
</div>
<div class="section level3">
<h3 id="fire-behavior">Fire Behavior<a class="anchor" aria-label="anchor" href="#fire-behavior"></a></h3>
<p>Van Wagner, C.E. (1977). Conditions for the start and spread of crown fire. <em>Canadian Journal of Forest Research</em> 7:23-34. <a href="https://doi.org/10.1139/x77-004" class="external-link uri">https://doi.org/10.1139/x77-004</a></p>
<p>Cruz, M.G., Alexander, M.E., Wakimoto, R.H. (2003). Assessing canopy fuel stratum characteristics in crown fire prone fuel types of western North America. <em>International Journal of Wildland Fire</em> 12:39-50.</p>
</div>
<div class="section level3">
<h3 id="spatial-statistics">Spatial Statistics<a class="anchor" aria-label="anchor" href="#spatial-statistics"></a></h3>
<p>Clark, P.J., Evans, F.C. (1954). Distance to nearest neighbor as a measure of spatial relationships in populations. <em>Ecology</em> 35:445-453.</p>
<p>Baddeley, A., Rubak, E., Turner, R. (2015). <em>Spatial Point Patterns: Methodology and Applications with R</em>. Chapman and Hall/CRC Press, London.</p>
</div>
<div class="section level3">
<h3 id="optimization-methods">Optimization Methods<a class="anchor" aria-label="anchor" href="#optimization-methods"></a></h3>
<p>Kirkpatrick, S., Gelatt, C.D., Vecchi, M.P. (1983). Optimization by simulated annealing. <em>Science</em> 220:671-680.</p>
<p>Metropolis, N., Rosenbluth, A.W., Rosenbluth, M.N., Teller, A.H., Teller, E. (1953). Equation of state calculations by fast computing machines. <em>Journal of Chemical Physics</em> 21:1087-1092.</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="appendix-a-complete-function-reference">Appendix A: Complete Function Reference<a class="anchor" aria-label="anchor" href="#appendix-a-complete-function-reference"></a></h2>
<div class="section level3">
<h3 id="main-simulation-function">Main Simulation Function<a class="anchor" aria-label="anchor" href="#main-simulation-function"></a></h3>
<p><strong><code><a href="reference/simulate_stand.html">simulate_stand()</a></code></strong> - <strong>Purpose</strong>: Run complete simulated annealing optimization - <strong>Key parameters</strong>: targets, weights, max_iterations, plot_interval - <strong>Returns</strong>: List with trees, metrics, history, energy</p>
</div>
<div class="section level3">
<h3 id="allometric-functions">Allometric Functions<a class="anchor" aria-label="anchor" href="#allometric-functions"></a></h3>
<p><strong><code>calc_crown_radius(dbh, species)</code></strong> - Linear relationship: radius = a + b × DBH - Species-specific parameters</p>
<p><strong><code>calc_height(dbh, species)</code></strong> - Asymptotic exponential: height = 1.3 + a × (1 - exp(-b × DBH)) - Maximum height varies by species</p>
<p><strong><code>calc_canopy_fuel_mass(dbh, crown_diam, species)</code></strong> - Uses Grier et al. (1992) for PIED - Uses Miller (1981) for JUSO/JUMO - Applies 6.2× calibration factor</p>
</div>
<div class="section level3">
<h3 id="metric-calculation-functions">Metric Calculation Functions<a class="anchor" aria-label="anchor" href="#metric-calculation-functions"></a></h3>
<p><strong><code>calc_tree_attributes(trees)</code></strong> - Computes all allometric attributes from DBH and Species - Vectorized for efficiency</p>
<p><strong><code>calc_stand_metrics(trees, plot_size)</code></strong> - Aggregates tree-level to stand-level metrics - Calculates CE_R, cover, CFL, density, species props</p>
<p><strong><code>calc_canopy_cover(x, y, crown_radius, plot_size)</code></strong> - Raster-based cover calculation - OpenMP-parallelized version available</p>
</div>
<div class="section level3">
<h3 id="perturbation-functions">Perturbation Functions<a class="anchor" aria-label="anchor" href="#perturbation-functions"></a></h3>
<p><strong><code>perturb_move(trees, plot_size)</code></strong> <strong><code>perturb_species(trees, species_names, species_probs)</code></strong> <strong><code>perturb_dbh(trees, dbh_sd)</code></strong> <strong><code>perturb_add(trees, ...)</code></strong> <strong><code>perturb_remove(trees, min_trees)</code></strong> <strong><code>perturb_add_with_nurse(trees, ..., nurse_distance)</code></strong></p>
</div>
<div class="section level3">
<h3 id="energy-functions">Energy Functions<a class="anchor" aria-label="anchor" href="#energy-functions"></a></h3>
<p><strong><code>calc_energy(metrics, targets, weights, ...)</code></strong> - Normalized relative error formulation - Returns total energy for acceptance decision</p>
<p><strong><code>calc_nurse_tree_energy(trees, nurse_distance)</code></strong> - Proportion of PIED within distance of nearest JUSO/JUMO - Returns 1 - proportion (0 = perfect association)</p>
<hr></div>
</div>
<div class="section level2">
<h2 id="appendix-b-troubleshooting">Appendix B: Troubleshooting<a class="anchor" aria-label="anchor" href="#appendix-b-troubleshooting"></a></h2>
<div class="section level3">
<h3 id="common-issues">Common Issues<a class="anchor" aria-label="anchor" href="#common-issues"></a></h3>
<p><strong>1. Simulation not converging</strong> - Increase max_iterations (try 100,000) - Lower cooling_rate slightly (try 0.9998) - Reduce weight conflicts (check if targets are feasible)</p>
<p><strong>2. Density staying fixed</strong> - Increase density weight (try 70-80) - Check adaptive perturbation logic - Verify targets are reasonable</p>
<p><strong>3. CFL too high/low</strong> - Check calibration factor (should be 6.2) - Verify allometric equations - May indicate infeasible target combination</p>
<p><strong>4. Species proportions not matching</strong> - Increase species weight (try 70-80) - Ensure species_names matches species_props length - Check that perturbations use correct probabilities</p>
<p><strong>5. Installation errors</strong> - Ensure Rtools installed (Windows) - Check C++ compiler available - Install dependencies: Rcpp, data.table, spatstat, ggplot2</p>
</div>
<div class="section level3">
<h3 id="performance-tips">Performance Tips<a class="anchor" aria-label="anchor" href="#performance-tips"></a></h3>
<p><strong>1. Use OpenMP if available</strong></p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"use_optimized_functions_parallel.R"</span><span class="op">)</span></span></code></pre></div>
<p><strong>2. Adjust thread count</strong></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DEFAULT_THREADS</span> <span class="op">&lt;-</span> <span class="fl">8</span>  <span class="co"># 50-75% of cores</span></span></code></pre></div>
<p><strong>3. Reduce plot_interval for faster runs</strong></p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_interval</span> <span class="op">=</span> <span class="cn">NULL</span>  <span class="co"># Disable plotting</span></span></code></pre></div>
<p><strong>4. Profile bottlenecks</strong></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/Rprof.html" class="external-link">Rprof</a></span><span class="op">(</span><span class="st">"profile.out"</span><span class="op">)</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simulate_stand.html">simulate_stand</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/Rprof.html" class="external-link">Rprof</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/summaryRprof.html" class="external-link">summaryRprof</a></span><span class="op">(</span><span class="st">"profile.out"</span><span class="op">)</span></span></code></pre></div>
<hr><p><em>This documentation was last updated: January 2026</em></p>
<p><em>Package version: 0.1.0</em></p>
<p><em>For questions or contributions, please visit the GitHub repository.</em></p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/bi0m3trics" class="external-link">Andrew Sánchez Meador</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

